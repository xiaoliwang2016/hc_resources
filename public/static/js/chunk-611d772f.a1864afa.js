(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-611d772f"],{"1b9f":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=this,n=t.$createElement,r=t._self._c||n;return r("div",[r("div",{staticClass:"head"},[t._v("当前用户："),r("b",[t._v(t._s(t.userName))])]),t._v(" "),r("div",{staticClass:"body clearfix"},[r("div",{staticClass:"left"},[r("div",{staticClass:"head"},[t._v("角色分配")]),t._v(" "),r("el-table",{staticStyle:{width:"100%"},attrs:{data:t.roleData}},[r("el-table-column",{attrs:{prop:"id",label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-checkbox",{on:{change:function(n){return t.roleChangeHandler(e.row.id,n)}},model:{value:e.row.selected,callback:function(n){t.$set(e.row,"selected",n)},expression:"scope.row.selected"}},[t._v(t._s(e.row.id))])]}}])}),t._v(" "),r("el-table-column",{attrs:{prop:"role_name",label:"角色名称",width:"120"}}),t._v(" "),r("el-table-column",{attrs:{prop:"role_desc",label:"职能描述"}})],1)],1),t._v(" "),r("div",{staticClass:"right"},[r("div",{staticClass:"head"},[t._v("资源分配")]),t._v(" "),r("el-tree",{ref:"tree",attrs:{data:t.resourcesTree,"show-checkbox":"","default-expand-all":!0,"node-key":"id"},on:{check:t.clickHandler},scopedSlots:t._u([{key:"default",fn:function(e){e.node;var n=e.data;return r("span",{staticClass:"custom-tree-node"},[r("span",[t._v(t._s(n.menu_title))])])}}])})],1)]),t._v(" "),r("div",{staticClass:"foot"},[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.save}},[t._v("保存")]),t._v(" "),r("el-button",{attrs:{size:"small"},on:{click:function(){e.$router.go(-1)}}},[t._v("返回")])],1)])},s=[],a=(n("ac6a"),n("5df3"),n("75fc")),i=(n("7f7f"),n("c24f")),c=n("cc5e"),o=n("63e8"),u=n("ed08"),d={data:function(){return{userName:"",roleData:[],resources:[],resourcesTree:[],selectedResources:[],initResources:[]}},mounted:function(){this.userName=this.$route.query.name,this.init()},methods:{init:function(){var e=this;Object(c["d"])({theme_id:this.$store.state.admin.themeInfo.id,role_group:0}).then(function(t){i["c"]({id:e.$route.query.id}).then(function(n){var r=n.data;t.data.map(function(e,n){t.data[n].selected=-1!=r.indexOf(e.id)}),e.roleData=t.data})}),Object(o["e"])({theme_id:this.$store.state.admin.themeInfo.id,tree:1}).then(function(t){e.resourcesTree=t.data}),Object(o["e"])({theme_id:this.$store.state.admin.themeInfo.id}).then(function(t){e.resources=t.data}),i["b"]({id:this.$route.query.id,theme_id:this.$store.state.admin.themeInfo.id}).then(function(t){var n=[],r=[];t.data.map(function(e){3==e.type&&n.push(e.id),r.push(e.id)}),e.selectedResources=r,e.initResources=n,e.$refs.tree.setCheckedKeys(n)})},clickHandler:function(e,t,n){this.initResources=t.checkedKeys,this.selectedResources=t.checkedKeys.concat(t.halfCheckedKeys)},roleChangeHandler:function(e,t){var n=this,r=Object(a["a"])(this.initResources),s=Object(a["a"])(this.selectedResources);Object(c["c"])({role_id:e}).then(function(e){t?e.data.map(function(e){s.push(e.id),3==e.type&&r.push(e.id)}):e.data.map(function(e){-1!=s.indexOf(e.id)&&(s.splice(s.indexOf(e.id),1),3==e.type&&r.splice(r.indexOf(e.id),1))}),n.initResources=Object(u["f"])(r),n.selectedResources=Object(u["f"])(s),n.$refs.tree.setCheckedKeys(n.initResources)})},save:function(){var e=this;this.loading=this.$loading({lock:!0});var t=[],n=[];this.roleData.map(function(e){e.selected&&t.push(e.id)}),n.push(Object(c["b"])({role_id:t,user_id:this.$route.query.id}),Object(o["c"])({resources_id:this.selectedResources,user_id:this.$route.query.id})),Promise.all(n).then(function(t){e.$message({message:"权限设置成功",type:"success"}),e.$router.go(-1),e.loading.close()}).catch(function(t){e.$message({message:"请求失败",type:"warning"}),e.loading.close()})}}},l=d,f=(n("67a3"),n("2877")),h=Object(f["a"])(l,r,s,!1,null,"718fb20f",null);t["default"]=h.exports},"1c66":function(e,t,n){},"5df3":function(e,t,n){"use strict";var r=n("02f4")(!0);n("01f9")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},"63e8":function(e,t,n){"use strict";n.d(t,"e",function(){return s}),n.d(t,"a",function(){return a}),n.d(t,"d",function(){return i}),n.d(t,"b",function(){return c}),n.d(t,"c",function(){return o});var r=n("b775");function s(e){return Object(r["a"])({url:"/admin/resources/list",method:"get",params:e})}function a(e){return Object(r["a"])({url:"/admin/resources/addOrUpdate",method:"post",data:e})}function i(e){return Object(r["a"])({url:"/admin/resources/delete",method:"post",data:e})}function c(e){return Object(r["a"])({url:"/admin/resources/assignToRole",method:"post",data:e})}function o(e){return Object(r["a"])({url:"/admin/resources/assignToUser",method:"post",data:e})}},"67a3":function(e,t,n){"use strict";var r=n("1c66"),s=n.n(r);s.a},c24f:function(e,t,n){"use strict";n.d(t,"e",function(){return s}),n.d(t,"a",function(){return a}),n.d(t,"g",function(){return i}),n.d(t,"b",function(){return c}),n.d(t,"c",function(){return o}),n.d(t,"d",function(){return u}),n.d(t,"f",function(){return d});var r=n("b775");function s(e){return Object(r["a"])({url:"/admin/user/list",method:"get",params:e})}function a(e){return Object(r["a"])({url:"/admin/user/add",method:"post",data:e})}function i(e){return Object(r["a"])({url:"/admin/user/update",method:"post",data:e})}function c(e){return Object(r["a"])({url:"/admin/user/listResources",method:"get",params:e})}function o(e){return Object(r["a"])({url:"/admin/user/listRole",method:"get",params:e})}function u(e){return Object(r["a"])({url:"/home/user/listTheme",method:"get",params:e})}function d(e){return Object(r["a"])({url:"/admin/employee/search",method:"get",params:e})}},cc5e:function(e,t,n){"use strict";n.d(t,"d",function(){return s}),n.d(t,"a",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"b",function(){return c}),n.d(t,"e",function(){return o});var r=n("b775");function s(e){return Object(r["a"])({url:"/admin/role/list",method:"get",params:e})}function a(e){return Object(r["a"])({url:"/admin/role/addOrUpdate",method:"post",data:e})}function i(e){return Object(r["a"])({url:"/admin/role/listResources",method:"get",params:e})}function c(e){return Object(r["a"])({url:"/admin/role/assignToUser",method:"post",data:e})}function o(){return Object(r["a"])({url:"/admin/role/listUser",method:"get",params:params})}}}]);